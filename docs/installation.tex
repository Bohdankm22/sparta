\htmlhr
\chapter{Installation and app setup\label{installation}}

This chapter describes how to install the SPARTA tools
(Section~\ref{sec:install}) and how to prepare an Android App to have the
SPARTA tools run on it (Section~\ref{sec:antsetup}).

\section {Requirements\label{sec:requirements}}
\paragraph{Java 7}
\begin{itemize}
 \item  \<.../jdk1.7.0/bin> must be on your path.
 \item \<JAVA\_HOME> should be set to \<.../jdk1.7.0>.
\end{itemize}

\paragraph{Ant}
\begin{itemize}
 \item Ant version 1.8.2 or later
\end{itemize}

\paragraph{Android SDK}
\begin{itemize}
 \item Install the Android SDK to some directory. 
 \item Set \<ANDROID\_HOME> to the directory where you installed the
   Android SDK.
 \item Download the \<android-15> target.  [[TODO: How?]]
\end{itemize}

If using Eclipse, go to
\<Help $\rightarrow$ Install New Software>
and install the Android ADT Plugin (\url{https://dl-ssl.google.com/android/eclipse}) and MercurialEclipse (\url{http://cbes.javaforge.com/update}).

\paragraph{Checker Framework}
\begin{itemize}
\item Follow the installation instructions in the manual: 
\url{http://types.cs.washington.edu/checker-framework/current/checkers-manual.html#installation}
\item As described in the installation instructions, set the \<CHECKERS>
  environment variable to \<.../checker-framework/checkers/>
\end{itemize}


\section{Install SPARTA\label{sec:install}}

\begin{enumerate}

\item
  Obtain the source code for the SPARTA tools, either from its version
  control repository or from a packaged release.

\begin{itemize}
\item
  To obtain from the version control repository, run
\begin{Verbatim}
 hg clone https://dada.cs.washington.edu/hgweb/sparta-code
\end{Verbatim}
  using the credentials you have been given.
\item 
  If you do not have access to the source code repository, then
  download the SPARTA release from
  \url{http://types.cs.washington.edu/sparta/release/}.  (Please do not
  publicize this URL.)  

  Then, unpack the archive.
\end{itemize}

%For now, we don't support the JSON feature
\item
Google gson is a dependency for the "-json" targets for projects.

\begin{itemize}
\item
If Google gson is already installed, then set build property \<gson.jar>, which defaults to:
\begin{alltt}
gson.jar=${basedir}/lib/google-gson-2.2.2/gson-2.2.2.jar
\end{alltt}
\item
If Google gson is not already installed, then 
get it from \url{http://code.google.com/p/google-gson/};
create directory \<sparta-code/lib> and unzip gson there.
\end{itemize}

\item Update the Android development environment

Run the following:

\begin{alltt}
ant -buildfile $SPARTA_CODE/build.local.xml
\end{alltt}

Alternatively, you can run:

\begin{alltt}
$ANDROID_HOME/tools/android update project -{}-path . -{}-target android-15
\end{alltt}


Rationale:  When working with Android, a developer must ``update a project'' to
properly set the path to the Android SDK\@.  (For more details about
updating a project, see
\url{http://developer.android.com/tools/projects/projects-cmdline.html#UpdatingAProject}.)


\item Build the SPARTA tools by compiling the source code:
\begin{alltt}
ant jar
\end{alltt}

\item
As a sanity check of the installation, run

\begin{alltt}
ant all-tests
\end{alltt}

You should see ``\<BUILD SUCCESSFUL>'' at the end.


%\noindent
%It is necessary to specify the Android SDK location, by setting the \<ANDROID\_HOME>
%environment variable or the \<android.home> property.  Here is an example
%of the latter:
%
%\begin{alltt}
%ant -Dandroid.home=... jar
%\end{alltt}
%
%See file \<build.properties> for other configuration properties.
%
%See the output of \<ant -p> for the build and test targets.
%
%All projects can also be built and tested in Eclipse.
%Import the annotation-tools, jsr308-langtools, checkers, javaparser,
%and sparta-code projects into a workspace.

\end{enumerate}


\section{Android App Setup\label{sec:antsetup}}

This section explains how to setup an Android application for analysis with the SPARTA tools.
\\ \\
1.) Ensure the following environment variables are set. 

\begin{itemize}
\item
\<CHECKERS> pointing to the
\<.../checker-framework/checkers> directory

\item
\<SPARTA\_CODE> pointing to the \<.../sparta-code> directory

\item
\<ANDROID\_HOME> pointing to the \<.../android-sdk> directory

\end{itemize}

\noindent
2.) If your Android project does not have a build.xml file, update the project.

\begin{alltt}
$ANDROID_HOME/tools/android update project -{}-path .
\end{alltt}

\noindent
3.) Add the SPARTA build targets to the end of the \<build.xml>
 file, just above \verb|</project>|.

% TODO: how does using lt and gt in TT mode work?

\begin{alltt}
<property environment="env"/>
<dirname property="checkers_dir" file="\$\{env.CHECKERS\}"/>
<basename property="checkers_base" file="\$\{env.CHECKERS\}"/>
<dirname property="sparta-code_dir" file="\$\{env.SPARTA_CODE\}"/>
<basename property="sparta-code_base" file="\$\{env.SPARTA_CODE\}"/>
<import file="\$\{sparta-code_dir\}/\$\{sparta-code_base\}/build.include.xml" optional="true"/>
\end{alltt}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "manual"
%%% TeX-command-default: "PDF"
%%% End: 

%  LocalWords:  hg SDK ADT Plugin MercurialEclipse gson json sparta jsr308
%  LocalWords:  Dandroid langtools javaparser
